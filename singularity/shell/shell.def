BOOTSTRAP: docker
FROM: debian:11.5

# Get a ZSH user shell in a singularity container
# Run it with:
# singularity run --cleanenv shell.sif

%files
init.vim /usr/local/etc/
github.vim /usr/local/etc/nvim/

%post
apt-get update
apt-get install -y git
apt-get install -y wget
apt-get install -y zsh
apt-get install -y fzf
apt-get install -y exa

# nvim
apt-get install -y neovim
echo "
alias vim='nvim -u /usr/local/etc/init.vim'
alias nvim='nvim -u /usr/local/etc/init.vim'
export TERM=xterm-256color
" >> /etc/zsh/zshenv

# vim-plug
cd /opt
mkdir /opt/nvim-plugged
mkdir /usr/local/etc/nvim/autoload
wget https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
mv plug.vim /usr/local/etc/nvim/autoload

# nvim plugins
apt-get install -y flake8
apt-get install -y yapf3 python3-yapf
apt-get install -y exuberant-ctags
cd /usr/bin/
ln -s yapf3 yapf
cd -
# apt-get install -y pylint
nvim -u /usr/local/etc/init.vim +PlugInstall +qall

# PURE ZSH PROMPT
cd /opt
git clone https://github.com/sindresorhus/pure.git
echo "fpath+=(/opt/pure)
autoload -U promptinit
promptinit
prompt pure
export PURE_PROMPT_SYMBOL='❮container❯'" >> /etc/zsh/zshenv 
chmod g-w,o-w /opt/pure

# Colors for ls
echo "
alias ls='ls --color=auto'
" >> /etc/zsh/zshenv

# zsh-histdb
apt-get install -y sqlite3
apt-get install -y bsdextrautils  # for column utility
cd /opt
git clone https://github.com/larkery/zsh-histdb
echo "source /opt/zsh-histdb/sqlite-history.zsh
autoload -Uz add-zsh-hook
source /opt/zsh-histdb/histdb-interactive.zsh
bindkey '^r' _histdb-isearch
" >> /etc/zsh/zshenv

# fzf-tab
cd /opt
git clone https://github.com/Aloxaf/fzf-tab.git
echo "
autoload -U compinit
compinit
source /opt/fzf-tab/fzf-tab.plugin.zsh
" >> /etc/zsh/zshenv

# zsh-syntax-highlighting
cd /opt
git clone https://github.com/zsh-users/zsh-syntax-highlighting.git
echo "
source /opt/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
" >> /etc/zsh/zshenv

# zsh-histdb-fzf
cd /opt
git clone https://github.com/m42e/zsh-histdb-fzf.git
echo "
source /opt/zsh-histdb-fzf/fzf-histdb.zsh
# histdb-fzf-widget_dir () {histdb-fzf-widget -d}
# zle -N histdb-fzf-widget_dir
bindkey '^R' histdb-fzf-widget
" >> /etc/zsh/zshenv

apt-get clean

%environment
export SHELL=/usr/bin/zsh
export PATH=$PATH:$HOME/bin

%runscript
zsh --no-rcs
