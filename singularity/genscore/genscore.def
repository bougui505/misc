BOOTSTRAP: docker
FROM: debian:12.1

%setup
if [ ! -d GenScore ]; then
  git clone --depth 1 https://github.com/sc8668/GenScore.git
fi

%files
GenScore /opt

%post
################################# APT INSTALL #################################
export DEBIAN_FRONTEND=noninteractive
mkdir -p /tmp/apt/cache
mkdir -p /tmp/apt/lists
echo 'Dir::Cache "/tmp/apt/cache";' > /etc/apt/apt.conf.d/99custom
echo 'Dir::State::Lists "/tmp/apt/lists";' >> /etc/apt/apt.conf.d/99custom

apt-get update
apt-get install -y python3-pip build-essential cmake libxml2-dev zlib1g-dev python3-dev git
###############################################################################

############################# OPENBABEL FROM SOURCE ###########################
mkdir -p /opt/openbabel_src
cd /opt/openbabel_src
git clone --depth 1 https://github.com/openbabel/openbabel .
mkdir build
cd build
cmake -DPYTHON_BINDINGS=ON -DCMAKE_INSTALL_PREFIX=/usr/local ..
make -j$(nproc)
make install
ldconfig
###############################################################################

################################# PIP INSTALL #################################
python3 -m pip config set global.break-system-packages true  # See: https://stackoverflow.com/a/75722775/1679629
mkdir -p /tmp/pip/cache
python3 -m pip config set global.cache-dir /tmp/pip/cache
cd /opt
pip3 install \
mdanalysis \
prody \
torch \
yacs \
pytorch_lightning

pip3 install \
torch-geometric \
torch-scatter \
rdkit \
scikit-learn \
scipy \
seaborn \
numpy\<2.3.0 \
pandas \
matplotlib \
joblib
###############################################################################

%environment
#    export BABEL_LIBDIR="/usr/local/lib/openbabel-3.1.1"
# %runscript
# cmd $@

