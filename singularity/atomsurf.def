BOOTSTRAP: docker
FROM: debian:13

%files

%post
################################# APT INSTALL #################################
export DEBIAN_FRONTEND=noninteractive
mkdir -p /tmp/apt/cache
mkdir -p /tmp/apt/lists
echo 'Dir::Cache "/tmp/apt/cache";' > /etc/apt/apt.conf.d/99custom
echo 'Dir::State::Lists "/tmp/apt/lists";' >> /etc/apt/apt.conf.d/99custom

apt-get update
apt-get install -y python3-pip git unzip
###############################################################################

cd /opt
git clone --depth 1 https://github.com/Vincentx15/atomsurf.git
cd atomsurf
rm -rf .git

################################# PIP INSTALL #################################
python3 -m pip config set global.break-system-packages true  # See: https://stackoverflow.com/a/75722775/1679629
mkdir -p /tmp/pip/cache
pip3 --cache-dir=/tmp/pip/cache install torch==2.0.1+cu118 torchvision==0.15.2+cu118 torchaudio==2.0.2 --index-url https://download.pytorch.org/whl/cu118
pip3 --cache-dir=/tmp/pip/cache install pyg-lib==0.4.0 -f https://data.pyg.org/whl/torch-2.0.1+cu118.html
pip3 --cache-dir=/tmp/pip/cache install git+https://github.com/pvnieo/diffusion-net-plus.git
pip3 --cache-dir=/tmp/pip/cache install -r requirements.txt
###############################################################################

%test
python3 -c "from torch_geometric.data import Data"
