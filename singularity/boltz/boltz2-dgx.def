BOOTSTRAP: docker
FROM: debian:12

%files
boltz_data /opt/

%post
export DEBIAN_FRONTEND=noninteractive
# mkdir -p /tmp/apt/cache
# mkdir -p /tmp/apt/lists
# echo 'Dir::Cache "/tmp/apt/cache";' > /etc/apt/apt.conf.d/99custom
# echo 'Dir::State::Lists "/tmp/apt/lists";' >> /etc/apt/apt.conf.d/99custom
apt-get update
apt-get install -y --no-install-recommends python3-pip git build-essential python3-dev gfortran pkg-config libopenblas-dev liblapack-dev cmake

python3 -m pip config set global.break-system-packages true
# mkdir -p /tmp/pip/cache
pip install boltz[cuda] -U
pip install cuequivariance-torch
pip install cuequivariance-ops-torch-cu12
touch /opt/boltz_data/mols.tar  # required (bug of boltz)

# FOR COMPATIBILITY WITH DGX-SPARK see: https://github.com/sanjyotshenoy/boltz-gb10-spark/
pip uninstall -y triton
# AI! Install the Triton-Nightly (3.6) which has support for Blackwell Architectures

%environment
export BOLTZ_CACHE=/opt/boltz_data
